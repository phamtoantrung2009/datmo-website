---
const {
  endpoint = 'https://dark-hat-f96f.phamtoantrung2009.workers.dev/quote',
  title = 'Nh·∫≠n b√°o gi√° thu√™ xe du l·ªãch nhanh',
} = Astro.props;

const formId = `quote-${Math.random().toString(36).slice(2, 8)}`;
---

<section class="container section">
  <div class="card">
    <h2>{title}</h2>

    <form id={formId} class="quote-form" novalidate>
      <!-- ROW 1 -->
      <div class="row">
        <div class="field">
          <label>ƒêi·ªÉm ƒë√≥n *</label>
          <input name="from" required placeholder="C·∫©m Ph·∫£ / C·ª≠a √îng / nh·∫≠p tay" />
        </div>

        <div class="field">
          <label>ƒêi·ªÉm ƒë·∫øn *</label>
          <input name="to" required placeholder="H√† N·ªôi / H·∫£i Ph√≤ng / ..." />
        </div>
      </div>

      <!-- ROW 2 -->
      <div class="row">
        <div class="field">
          <label>Ng√†y ƒëi *</label>
          <input type="date" name="start_date" required />
        </div>

        <div class="field">
          <label>Ng√†y v·ªÅ *</label>
          <input type="date" name="end_date" required />
        </div>
      </div>

      <!-- ROW 3 -->
      <div class="row">
        <div class="field">
          <label>Lo·∫°i xe *</label>
          <select name="vehicle" required>
            <option value="">Ch·ªçn lo·∫°i xe</option>
            <option>16 ch·ªó</option>
            <option>29 ch·ªó</option>
            <option>45 ch·ªó</option>
          </select>
        </div>

        <div class="field">
          <label>S·ªë ƒëi·ªán tho·∫°i *</label>
          <input
            name="phone"
            type="tel"
            required
            inputmode="tel"
            placeholder="VD: 0989 123 456"
          />
        </div>
      </div>

      <button type="submit" class="btn primary full">
        Y√™u c·∫ßu b√°o gi√°
      </button>

      <p class="status" aria-live="polite"></p>
    </form>
  </div>
</section>

<script is:inline>
  const form = document.getElementById('{formId}');
  const status = form.querySelector('.status');

  form.addEventListener('submit', async (e) => {
    e.preventDefault(); // üî¥ QUAN TR·ªåNG

    status.textContent = 'ƒêang g·ª≠i...';

    if (!form.reportValidity()) {
      status.textContent = 'Vui l√≤ng ƒëi·ªÅn ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc.';
      return;
    }

    const fd = new FormData(form);

    try {
      const res = await fetch('{endpoint}', {
        method: 'POST',
        body: fd,
      });

      const data = await res.json();

      if (res.ok && data.success) {
        form.reset();
        status.textContent = 'ƒê√£ g·ª≠i y√™u c·∫ßu. Datmo s·∫Ω li√™n h·ªá s·ªõm.';
      } else {
        status.textContent = data.error || 'G·ª≠i kh√¥ng th√†nh c√¥ng.';
      }
    } catch {
      status.textContent = 'L·ªói k·∫øt n·ªëi. Vui l√≤ng th·ª≠ l·∫°i.';
    }
  });
</script>

<style>
.quote-form .row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}
.quote-form .field {
  display: flex;
  flex-direction: column;
}
.quote-form .full {
  width: 100%;
}
@media (max-width: 768px) {
  .quote-form .row {
    grid-template-columns: 1fr;
  }
}
</style>
