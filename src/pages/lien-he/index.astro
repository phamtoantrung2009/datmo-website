---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getOgImage } from '../../config/og';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import { SITE } from '../../config/site';
import JsonLd from '../../components/JsonLd.astro';
import { getOrganizationId } from '../../utils/schema';

// SEO: tune title/description length for SERP.
const title = 'Liên hệ đặt dịch vụ nhanh Cẩm Phả, Quảng Ninh | Datmo';
const description = 'Liên hệ Datmo để đặt thuê xe, tour, vé tàu cao tốc, vé máy bay, khách sạn, visa – hộ chiếu tại Cẩm Phả, Quảng Ninh. Hotline hỗ trợ nhanh, phản hồi nhanh.';
const ogImage = getOgImage('/lien-he/');
const crumbs = [
  { name: 'Trang chủ', href: '/' },
  { name: 'Liên hệ', href: '/lien-he/' },
];

const contactPageJsonLd = {
  '@context': 'https://schema.org',
  '@type': 'ContactPage',
  name: 'Liên hệ Datmo',
  url: SITE.url + '/lien-he/',
  inLanguage: 'vi-VN',
  mainEntity: { '@id': getOrganizationId(SITE) },
};
---
<BaseLayout title={title} description={description} ogImage={ogImage}>
  <Breadcrumbs items={crumbs} />
  <section class="container section">
    <h1>Liên hệ đặt dịch vụ</h1>
    <p class="lead">Gọi/Zalo để chốt lịch, nhận báo giá và xác nhận dịch vụ.</p>

    <div class="grid-2">
      <div class="card">
        <h2>Hotline</h2>
        <p class="small"><a class="btn primary" href={`tel:${SITE.phone}`}>Gọi: {SITE.phoneDisplay}</a></p>
        <p class="small">Ưu tiên cung cấp: ngày đi, số lượng khách, tuyến/điểm đón, yêu cầu đặc biệt.</p>
      </div>
      <div class="card">
        <h2>Zalo</h2>
        <p class="small"><a class="btn" href={SITE.zaloUrl} rel="nofollow">Nhắn Zalo</a></p>
        <p class="small">Gửi tin nhắn theo mẫu: “Ngày đi – tuyến – số khách – dịch vụ cần đặt”.</p>
      </div>
    </div>

    <div class="card" style="margin-top:14px">
      <h2>Form liên hệ</h2>
      <form id="contact-form" method="POST" action="/api/contact" class="form-grid">
        <div class="form-field">
          <label for="full_name">Họ tên *</label>
          <input id="full_name" name="full_name" type="text" required />
        </div>
        <div class="form-field">
          <label for="phone">Số điện thoại *</label>
          <input id="phone" name="phone" type="tel" required />
        </div>
        <div class="form-field">
          <label for="service">Dịch vụ cần tư vấn *</label>
          <select id="service" name="service" required>
            <option value="">Chọn dịch vụ</option>
            <option value="Thuê xe du lịch">Thuê xe du lịch</option>
            <option value="Tour du lịch">Tour du lịch</option>
            <option value="Vé tàu cao tốc">Vé tàu cao tốc</option>
            <option value="Vé máy bay">Vé máy bay</option>
            <option value="Khách sạn">Khách sạn</option>
            <option value="Visa – hộ chiếu">Visa – hộ chiếu</option>
          </select>
        </div>
        <div class="form-field">
          <label for="message">Nội dung</label>
          <textarea id="message" name="message" rows="4" placeholder="Ngày đi – tuyến – số khách – yêu cầu..."></textarea>
        </div>
        <input type="text" name="company" class="hp-field" tabindex="-1" autocomplete="off" aria-hidden="true" />
        <input type="hidden" name="ts" value="" />
        <button class="btn primary" type="submit">Nhận tư vấn</button>
        <p id="form-status" class="small form-status" role="status" aria-live="polite"></p>
      </form>
      <p class="small">Gửi form để nhận tư vấn qua email: {SITE.email}</p>
    </div>

    <section class="section" aria-label="Bản đồ văn phòng">
      <h2>Bản đồ văn phòng Đất Mỏ Travel</h2>
      <div class="map-embed" aria-hidden="true">
        <iframe
          src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3723.94538987109!2d107.36213077609592!3d21.034870980616034!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x314b014cda277013%3A0xe92d70a486faea99!2zxJDhuqRUIE3hu44gVFJBVkVM!5e0!3m2!1svi!2s!4v1770093139683!5m2!1svi!2s"
          width="600"
          height="450"
          style="border:0;"
          allowfullscreen=""
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"
          title="Bản đồ văn phòng Đất Mỏ Travel"
        ></iframe>
      </div>
      <p class="small">Số nhà 56, tổ 51, khu 4B2, Phường Cửa Ông, Cẩm Phả, Quảng Ninh, Việt Nam</p>
    </section>

    <div class="card" style="margin-top:14px">
      <h2>Dịch vụ liên quan</h2>
      <ul class="link-list">
        <li><a href="/thue-xe-du-lich/">Thuê xe du lịch 16–45 chỗ tại Cẩm Phả</a></li>
        <li><a href="/tour-du-lich/">Tour xuất phát từ Cẩm Phả</a></li>
        <li><a href="/ve-tau-cao-toc/">Vé tàu cao tốc Ao Tiên/Vũng Đục</a></li>
        <li><a href="/ve-may-bay/">Vé máy bay</a> • <a href="/khach-san/">Khách sạn</a> • <a href="/visa-ho-chieu/">Visa – hộ chiếu</a></li>
      </ul>
    </div>
  </section>
  <JsonLd data={contactPageJsonLd} />
</BaseLayout>

<script is:inline>
  const form = document.getElementById('contact-form');
  const statusEl = document.getElementById('form-status');
  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (statusEl) statusEl.textContent = 'Đang gửi...';
      const fd = new FormData(form);
      const ts = form.querySelector('input[name="ts"]');
      if (ts) ts.value = Date.now().toString();
      try {
        const res = await fetch(form.action, { method: 'POST', body: fd });
        let data = null;
        try {
          data = await res.json();
        } catch (_) {
          // Non-JSON response (e.g., 404 HTML) — fallback to generic message.
        }
        if (res.ok && data && data.success) {
          form.reset();
          if (statusEl) statusEl.textContent = 'Đã gửi yêu cầu. Datmo sẽ liên hệ sớm.';
        } else {
          const msg = data && data.message ? data.message : `Gửi không thành công (HTTP ${res.status}). Vui lòng thử lại.`;
          if (statusEl) statusEl.textContent = msg;
        }
      } catch (err) {
        if (statusEl) statusEl.textContent = 'Có lỗi kết nối. Vui lòng thử lại.';
      }
    });
  }
</script>
